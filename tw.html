<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>EON Examples</title>
  <meta name='viewport' content='initial-scale=1, maximum-scale=1, user-scalable=no' />
  <style>
    html, body { margin:0; padding:0; }
    #text { position:absolute; top:5px; }
    #chart { left:0; right:0; display:flex; align-items:center; }
    #gaugeChart, #donutChart, #barChart, #splineChart { flex:1; margin:10px; }
    #map { position:absolute; top:345px; bottom:10px; left:10px; right:10px }
  </style>
  <link type='text/css' rel='stylesheet' href='//pubnub.github.io/eon/v/eon/1.1.0/eon.css'/>
  <script type='text/javascript' src='//pubnub.github.io/eon/v/eon/1.1.0/eon.js'></script>
</head>

<body>

<div id='text'><h3>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Asset: TW822357-TT</h2></div>
<div id='chart'>
  <div id='gaugeChart'></div>
  <div id='donutChart'></div>
  <div id='barChart'></div>
  <div id='splineChart'></div>
</div>
<div id='map'></div>

<script>

  var pn = new PubNub({ publishKey:'demo', subscribeKey:'demo' });
  //ssl:(('https:' == document.location.protocol) ? true : false)

  var chartChannels = ['chan1', 'chan2', 'chan3', 'chan4'];
  var typeStr = 'gauge' // gauge bar donut spline
  eon.chart({
    pubnub:pn, id:'gaugeChart', channels:[chartChannels[0]],
    generate: {
      bindto:'#gaugeChart',
      data: { labels:true, type:typeStr },
      gauge: { min:0, max:100, label: { format: function(value, ratio) {return (value)+'kg' }}},
      color: { pattern:['#60B044', '#F6C600', '#FF0000'],
      threshold: { values:[70, 90, 100] }, }}});
  var typeStr = 'donut'
  eon.chart({
    pubnub:pn, id:'donutChart', channels:[chartChannels[1]],
    generate: {
      bindto:'#donutChart', tooltip: { show:true },
      data: { labels:true, type:typeStr },
      donut: { title:'Axil Ratio' }, }});
  var typeStr = 'bar'
  eon.chart({
    pubnub:pn, id:'barChart', channels:[chartChannels[2]],
    generate: {
      bindto:'#barChart', tooltip: { show:true },
      data: { labels:true, type:typeStr },
      bar: { zerobased:true, width: { ratio:1 } },
      axis: { y: { max:90 } }, }});
  var typeStr = 'area-spline'
  eon.chart({
    pubnub:pn, id:'splineChart', channels:[chartChannels[3]], limit:10,
    generate: {
      bindto:'#splineChart', tooltip: { show:false },
      data: { labels:true, type:typeStr },
      area: { zerobased:true },
      axis: { x: { type:'timeseries', tick: { format:'%H:%m:%S' } }, y: { max:90 } },
      zoom: { enabled:true }, transition: { duration:50 }, },
  });

  var a1=0, a2=0, a3=0, t1=0;
  setInterval(function(){
    a1 = 40 + Math.floor(Math.random() * 59)
    a2 = 83 + Math.floor(Math.random() * 9)
    a3 = 20 + Math.floor(Math.random() * 9)
    t1 = 7 + Math.floor(Math.random() * 5)
    pn.publish({ channel:chartChannels[0], message: { eon: {
      'Axle 1':a1, }}})
    pn.publish({ channel:chartChannels[1], message: { eon: {
      'Axle 1':a1, 'Axle 2':a2, '_eonDatetime':1550689920292, }}})
    pn.publish({ channel:chartChannels[2], message: { eon: {
      'Axle 1':a1, 'Axle 2':a2, 'Axle 3':a3, 'Temp':t1, '_eonDatetime':1550689920292, }}})
    pn.publish({ channel:chartChannels[3], message: { eon: {
      'Axle 1':a1, 'Axle 2':a2, 'Axle 3':a3, 'Temp':t1, '_eonDatetime':1550689920292, }}})
  }, 3000);



  var mapChannels = ['pubnub-mapbox-1', 'pubnub-mapbox-2', 'pubnub-mapbox-3'];
  var map = eon.map({
    pubnub:pn, id:'map', channels:mapChannels,
    mbId:'ianjennings.l896mh2e',
    mbToken:'pk.eyJ1IjoiaWFuamVubmluZ3MiLCJhIjoiZExwb0p5WSJ9.XLi48h-NOyJOCJuu1-h-Jg',
    rotate:true, history:true,
    options: { center:[44.734, -63.655], zoom:12.5, zoomAnimation:false, attributionControl:false },
    connect:beginPublishingMaps,
  });

  function beginPublishingMaps() {
    setInterval(function(){
      publish('truck1', mapChannels[0]);
      publish('truck2', mapChannels[1]);
      publish('truck3', mapChannels[2]);
    }, 5000); };
  function publish(pointId, channel) {
    var point = { latlng:[44.734, -63.655] };
    var new_point = JSON.parse(JSON.stringify(point));
    new_point = {
      latlng:[
        new_point.latlng[0] + (getNonZeroRandomNumber() * 0.00005),
        new_point.latlng[1] + (getNonZeroRandomNumber() * 0.0001) ]};
    var m = {}; m[pointId] = new_point;
    console.log(m)
    pn.publish({ channel:channel, message:m }); }
  function getNonZeroRandomNumber(){
    var random = Math.floor(Math.random()*199) - 99;
    if(random==0) return getNonZeroRandomNumber();
    return random; }

</script>


</body>
</html>

