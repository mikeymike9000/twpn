<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>EON Examples</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <style>
    html, body { margin: 0; padding: 0; }
    #text { position: absolute; }
    #chart { position: absolute; left: 0; right: 0; display: flex; align-items: center; }
    #gaugeChart, #donutChart, #barChart, #splineChart { flex: 1; margin: 20px; }
    #map { position: fixed; top: 370px; bottom:20px; left: 20px; right: 20px }
  </style>
  <link type='text/css' rel='stylesheet' href='//pubnub.github.io/eon/v/eon/1.1.0/eon.css'/>
  <script type='text/javascript' src='//pubnub.github.io/eon/v/eon/1.1.0/eon.js'></script>
</head>

<body>

<div id='text'><p><h3>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Asset: TW822356-TT</h2></div>
<div id='chart'>
  <div id='gaugeChart'></div>
  <div id='donutChart'></div>
  <div id='barChart'></div>
  <div id='splineChart'></div>
</div>
<div id='map'></div>

<script>

  var pubnub = new PubNub({ publishKey: 'demo', subscribeKey: 'demo' });
  var a1=0, a2=0, a3=0, t1=0;
  setInterval(function(){
    a1 = 40 + Math.floor(Math.random() * 59)
    a2 = 83 + Math.floor(Math.random() * 9)
    a3 = 20 + Math.floor(Math.random() * 9)
    t1 = 7 + Math.floor(Math.random() * 5)
  }, 1000);

  var typeStr = 'gauge' // gauge bar donut spline
  eon.chart({
    pubnub: pubnub, id: 'gaugeChart', channels: ['blah1'],
    generate: {
      bindto: '#gaugeChart',
      data: { labels: true, type: typeStr },
      gauge: { min: 0, max: 100, label: { show: true } },
      color: { pattern: [ '#60B044', '#F6C600', '#FF0000'], threshold: { values: [70, 90, 100] } },
  }});
  setInterval(function(){
    pubnub.publish({
      channel: 'blah1',
      message: { eon: {
          'Axle 1': a1,
  }}})}, 1000);

  var typeStr = 'donut'
  eon.chart({
    pubnub: pubnub, id: 'donutChart', channels: ['blah3'],
    generate: {
      bindto: '#donutChart', tooltip: { show: true },
      data: { labels: true, type: typeStr },
  }});
  setInterval(function(){
    pubnub.publish({
      channel: 'blah3',
      message: { eon: {
          'Axle 1': a1, 'Axle 2': a2, '_eonDatetime': 1550689920292
  }}})}, 1000);

  var typeStr = 'bar'
  eon.chart({
    pubnub: pubnub, id: 'barChart', channels: ['blah2'],
    generate: {
      bindto: '#barChart', tooltip: { show: true },
      data: { labels: true, type: typeStr },
      bar: { width: { ratio: 1 } },
      axis: { y: { min: 0, max: 90 } }
  }});
  setInterval(function(){
    pubnub.publish({
      channel: 'blah2',
      message: { eon: {
          'Axle 1': a1, 'Axle 2': a2, 'Axle 3': a3, 'Temp': t1, '_eonDatetime': 1550689920292
  }}})}, 1000);

  var typeStr = 'area-spline'
  eon.chart({
    pubnub: pubnub, id: 'splineChart', channels: ['blah4'], limit: 10,
    generate: {
      bindto: '#splineChart', tooltip: { show: false },
      data: { labels: true, type: typeStr },
      axis: { x: { type: 'timeseries', tick: { format: '%H:%m:%S' } }, y: { min: 0, max: 90 } },
      zoom: { enabled: true },
      transition: { duration: 50 },
  }});
  setInterval(function(){
    pubnub.publish({
      channel: 'blah4',
      message: { eon: {
          'Axle 1': a1, 'Axle 2': a2, 'Axle 3': a3, 'Temp': t1, '_eonDatetime': 1550689920292
  }}})}, 1000);

</script>


<script>
  var pubnub = new PubNub({ publishKey: 'demo', subscribeKey: 'demo' });
  var channels = ['pubnub-mapbox-1', 'pubnub-mapbox-2', 'pubnub-mapbox-3'];
  pubnub.channelGroups.addChannels(
    { channels: channels, channelGroup: "pubnub-mapbox-example" },
    function(status) {
    if (status.error) { console.log("operation failed, status: ", status); }
    else {
      console.log("operation done!")
      pubnub.channelGroups.listChannels({ channelGroup: "pubnub-mapbox-example" },
        function (status, response) {
          if (status.error) { console.log("operation failed w/ error:", status); return; }
          console.log("listing push channel for device")
          response.channels.forEach( function (channel) {
          console.log(channel)
  })});}});

  eon.map({
    pubnub: pubnub, id: 'map', channelGroups: ['pubnub-mapbox-example'],
    mbId: 'ianjennings.l896mh2e',
    mbToken: 'pk.eyJ1IjoiaWFuamVubmluZ3MiLCJhIjoiZExwb0p5WSJ9.XLi48h-NOyJOCJuu1-h-Jg',
    //mbId: 'mikeymike9000.cjse1c5uo05dr33ommg8qf992-7oo3x',
    //mbToken: 'pk.eyJ1IjoibWlrZXltaWtlOTAwMCIsImEiOiJjanNkdzAzdTUwMm96NDNydDF0OHE1cTZjIn0.MzfWySNPVSLQjaKIIBSP4A',
    rotate: true, history: true,
    options: { center: [44.734, -63.655], zoom: 12.5, zoomAnimation: true, 
    //sources: { mapbox-streets: { type: "vector", url: "mapbox://mapbox.mapbox-streets-v6" },
    //sprite: "mapbox://sprites/mapbox/bright-v8", pitch: 70,
    },
    connect: connect
  });

  function connect() {
    setInterval(function(){
      publish('first', channels[0]);
      publish('second', channels[1]);
      publish('third', channels[2]);
    }, 5000); };
  function publish(pointId, channel) {
    var point = { latlng: [44.734, -63.655] };
    var new_point = JSON.parse(JSON.stringify(point));
    new_point.latlng = [
    new_point.latlng[0] + (getNonZeroRandomNumber() * 0.00005),
    new_point.latlng[1] + (getNonZeroRandomNumber() * 0.0001) ];
    var m = {}; m[pointId] = new_point;
    pubnub.publish({ channel: channel, message: m }); }
  function getNonZeroRandomNumber(){
    var random = Math.floor(Math.random()*199) - 99;
    if(random==0) return getNonZeroRandomNumber();
    return random; }

</script>





<!--
publishKey: 'pub-c-b7574a7c-f784-49fb-bd6a-25f0c61d7aba',
subscribeKey: 'sub-c-3b490ca8-02cb-11e8-b09a-5e0f113aa1d7',
mbId: 'mikeymike9000.cjse1c5uo05dr33ommg8qf992-7oo3x',
mbToken: 'pk.eyJ1IjoibWlrZXltaWtlOTAwMCIsImEiOiJjanNkdzAzdTUwMm96NDNydDF0OHE1cTZjIn0.MzfWySNPVSLQjaKIIBSP4A',
mbToken: 'pk.eyJ1IjoibWlrZXltaWtlOTAwMCIsImEiOiJjanNkcTNmcXEweTdzNDRwM2ZmejU0cmt4In0.kWt6wJErgg3g-Nkrgnzg7Q',
secret:  'sk.eyJ1IjoibWlrZXltaWtlOTAwMCIsImEiOiJjanNlMTBjdGcwZ21wNDl0aHcwbzB2ZnhuIn0.4wJ5z_v3E9xcmVzcirhAKg',
<script src='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
-->

</body>
</html>

